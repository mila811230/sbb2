<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Messages</title>
</head>
<body>
<!-- 비어있는 messages div -->
<h1>Message List</h1>
<div id="loading_id" class="loading">Loading...</div>
<div id="error_id" class="error">fetching 과정에서 오류가 발생했습니다</div>
<ul id="messageList_id"></ul>

<!-- 자바스크립트로 fetch를 이용해 /messages/api 경과를 위 div에 답는다 -->
<script th:inline="javascript">
function fetchMessages() {
	const messageList = document.getElementById("messageList_id");
	const loading = document.getElementById("loading_id");
	const error = document.getElementById("error_id");
	
	loading.style.display = "block";
	error.style.display = "none";
	messageList.innerHTML = "";
	
	fetch("/messages/api")
	.then(response => {
		// 응답 결과를 json으로 변환
		if(!response.ok) {
			throw new Error("Network response was not ok");
		}
		return response.json();
		
	})
	.then(messages => {
		// 변환된 결과는 li요소로 만들어 화면에 추가	
		loading.style.display = "none";
		messages.forEach(msg => {
			const li = document.createElement("li");
			li.textContent = `${msg.message} (${msg.id})`;
			messageList.appendChild(li);
		})
	})
	.catch(error => {
		console.error("fetch error:", err);
		loading.style.display = "none";
		error.style.display = "block";
	})
}
fetchMessages();

//문서가 모두 로딩되면 fetchMessage() 함수를 실행
document.addEventListener("DOMContentLoad", fetchMessages);

</script>
</body>
</html>